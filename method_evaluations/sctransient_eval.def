Bootstrap: docker
From: ubuntu:22.04

%files
all_reqs.txt /all_reqs.txt
wavelet_pseudotime-0.0.0-py3-none-any.whl /wavelet_pseudotime-0.0.0-py3-none-any.whl

%environment

%post
su - root

apt-get update -qq
apt-get install -y -q --no-install-recommends \
    apt-utils \
    bzip2 \
    ca-certificates \
    curl \
    locales \
    unzip \
    git

apt-get install -y -q --no-install-recommends build-essential
apt-get install -y -q --no-install-recommends python3-setuptools
apt-get install -y python3.11 python3.11-dev python3-pip
apt-get install -y -q --no-install-recommends sudo wget
apt-get install -y graphviz

echo `gcc --version`
# Install R
apt-get install -y gfortran libblas-dev liblapack-dev libpcre2-dev libbz2-dev zlib1g-dev liblzma-dev
apt-get install -y gcc libopenblas-dev libssl-dev libcurl4-openssl-dev libxml2-dev libgdal-dev libbz2-dev libicu-dev
 

python3.11 -m pip install --upgrade pip

DEBIAN_FRONTEND=noninteractive apt-get install -y tzdata
dpkg-reconfigure --frontend noninteractive tzdata
apt install -y --no-install-recommends software-properties-common dirmngr
wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"

apt install -y --no-install-recommends r-base

#pip install -r /all_reqs.txt
pip install /wavelet_pseudotime-0.0.0-py3-none-any.whl
pip install -r /all_reqs.txt

R -e 'install.packages("BiocManager")'
R -e 'install.packages("statmod")'
R -e 'BiocManager::install("tradeSeq")'
R -e 'install.packages("R.devices")'

apt-get clean
rm -rf /var/lib/apt/lists/*

%runscript
echo "hello"
